var $url="/pages/plugins/addLayerUpload",$urlUpload=apiUrl+"/pages/plugins/addLayerUpload/actions/upload",data={pageLoad:!1,pageAlert:null,importType:"nupkg",file:null,files:[]},methods={loadConfig:function(){var e=this;e.pageLoad=!0,$api.get($url).then(function(t){setTimeout(function(){e.loadUploader()},100)}).catch(function(t){e.pageAlert=utils.getPageAlert(t)}).then(function(){e.pageLoad=!0})},loadUploader:function(){var e=this,t=Q.event,a=Q.Uploader,i=document.getElementById("drop-area"),n=new a({url:$urlUpload,target:document.getElementById("drop-area"),allows:".nupkg",on:{add:function(t){if(t.ext!="."+e.importType)return alert({title:"文件错误！",text:"离线插件文件格式为：."+e.importType,type:"error",showConfirmButton:!1}),!1},complete:function(t){var a=t.json;if(!a||1!=a.ret)return alert({title:"文件上传失败！",type:"error",showConfirmButton:!1});a&&a.fileName&&e.files.push(a)}}});a.support.html5&&n.html5?(t.add(i,"dragleave",t.stop),t.add(i,"dragenter",t.stop),t.add(i,"dragover",t.stop),t.add(i,"drop",function(e){t.stop(e);var a=e.dataTransfer.files;n.addList(a)})):i.innerHTML="点击批量上传文件"},del:function(e){this.files.splice(this.files.indexOf(e),1)},getFileNames:function(){for(var e=[],t=0;t<this.files.length;t++)e.push(this.files[t].fileName);return e},btnSubmitClick:function(){var e=this;if(this.pageAlert=null,!this.getFileNames().join(","))return alert({title:"请上传插件安装包文件！",type:"warning",showConfirmButton:!1});parent.pageUtils.loading(!0),$api.post({siteId:e.siteId,channelId:e.channelId,importType:e.importType,fileNames:e.getFileNames(),checkedLevel:e.checkedLevel,isOverride:e.isOverride},function(t,a){if(parent.pageUtils.loading(!1),t)return e.pageAlert={type:"danger",html:a.message};parent.location.reload(!0)})}};new Vue({el:"#main",data:data,methods:methods,created:function(){this.loadConfig()}});