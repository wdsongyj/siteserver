var $api=new apiUtils.Api(apiUrl+"/pages/cms/create"),$apiAll=new apiUtils.Api(apiUrl+"/pages/cms/create/all"),$siteId=parseInt(pageUtils.getQueryStringByName("siteId")),$type=pageUtils.getQueryStringByName("type"),data={pageLoad:!1,pageAlert:null,pageType:null,siteId:$siteId,type:$type,root:null,pageChannels:[],isAllChecked:!1,isDescendent:!1,isChannelPage:"channels"===$type,isContentPage:"contents"===$type,scope:"all"},methods={displayChildren:function(e,i){e.isOpen?this.hideChildren(e):this.showChildren(e),i.stopPropagation()},toggleChecked:function(e){e.isChecked=!e.isChecked,e.isChecked||(this.isAllChecked=!1)},selectAll:function(){this.isAllChecked=!this.isAllChecked;for(var e=0;e<this.pageChannels.length;e++)this.pageChannels[e].isChecked=this.isAllChecked;this.reload()},create:function(){var e=this;e.pageLoad=!1;for(var i=[],t=0;t<this.pageChannels.length;t++)this.pageChannels[t].isChecked&&i.push(this.pageChannels[t].id);(e.isAllChecked||0!==i.length)&&(e.isChannelPage||this.isContentPage)&&$api.post({siteId:e.siteId,channelIdList:e.isAllChecked?[]:i,isAllChecked:e.isAllChecked,isDescendent:e.isDescendent,isChannelPage:e.isChannelPage,isContentPage:e.isContentPage,scope:e.scope},function(){location.href="createStatus.cshtml?siteId="+e.siteId})},createIndex:function(){var e=this;$api.post({siteId:e.siteId,channelIdList:[e.siteId],isAllChecked:!1,isDescendent:!1,isChannelPage:!0,isContentPage:!1},function(){location.href="createStatus.cshtml?siteId="+e.siteId})},createAll:function(){var e=this;$apiAll.post({siteId:e.siteId},function(){location.href="createStatus.cshtml?siteId="+e.siteId})},loadChannels:function(){var e=this;$api.get({siteId:$siteId,parentId:$siteId},function(i,t){if(!i&&t&&t.value){e.root=_.assign({},t.parent,{contentNum:t.countDict[t.parent.id],isOpen:!0,isLoading:!1,isChecked:!1,children:[]});for(var n=0;n<t.value.length;n++){var s=_.assign({},t.value[n],{contentNum:t.countDict[t.value[n].id],isOpen:!1,isLoading:!1,isChecked:!1,children:[]});e.root.children.push(s)}e.reload(),e.pageLoad=!0}})},reload:function(){this.pageChannels=[],this.addPageChannels(this.root)},addPageChannels:function(e){if(this.pageChannels.push(e),e.isOpen)for(var i=0;i<e.children.length;i++){var t=e.children[i];this.addPageChannels(t)}},showChildren:function(e){var i=this;e.isOpen=!0,e.childrenCount>0&&0===e.children.length?(e.children=[],e.isLoading=!0,$api.get({siteId:$siteId,parentId:e.id},function(t,n){if(!t&&n&&n.value){for(var s=0;s<n.value.length;s++){var a=_.assign({},n.value[s],{contentNum:n.countDict[n.value[s].id],isOpen:!1,isLoading:!1,isChecked:i.isAllChecked,children:[]});e.children.push(a)}e.isLoading=!1,i.reload()}})):this.reload()},hideChildren:function(e){e.isOpen=!1,this.reload()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){"index"===this.type?this.createIndex():"all"===this.type?this.createAll():this.loadChannels()}});