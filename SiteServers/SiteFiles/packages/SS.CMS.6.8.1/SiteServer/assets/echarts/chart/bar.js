define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(e){function t(e,t,r,a,o){i.call(this,e,t,r,a,o),this.refresh(a)}var i=e("./base"),r=e("zrender/shape/Rectangle");e("../component/axis"),e("../component/grid"),e("../component/dataZoom");var a=e("../config");a.bar={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}}}};var o=e("../util/ecData"),s=e("zrender/tool/util"),n=e("zrender/tool/color");return t.prototype={type:a.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(e,t,i,o,s){for(var n,h,l,d,x,g,p,m,c,u,y,b,f=this.series,I=i[0][0],A=f[I],C="horizontal"==s,M=this.component.xAxis,B=this.component.yAxis,v=C?M.getAxis(A.xAxisIndex):B.getAxis(A.yAxisIndex),_=this._mapSize(v,i),W=_.gap,N=_.barGap,z=_.barWidthMap,S=_.barMaxWidthMap,T=_.barWidth,Y=_.barMinHeightMap,G=_.interval,L=this.deepQuery([this.ecTheme,a],"island.r"),k=0,F=t;F>k&&null!=v.getNameByIndex(k);k++){C?d=v.getCoordByIndex(k)-W/2:x=v.getCoordByIndex(k)+W/2;for(var X=0,w=i.length;w>X;X++){var H=f[i[X][0]].yAxisIndex||0,E=f[i[X][0]].xAxisIndex||0;p=g=c=m=(n=C?B.getAxis(H):M.getAxis(E)).getCoord(0);for(var R=0,V=i[X].length;V>R;R++)y=(A=f[I=i[X][R]]).data[k],b=this.getDataFromOption(y,"-"),o[I]=o[I]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},l=Math.min(S[I]||Number.MAX_VALUE,z[I]||T),"-"!==b&&(b>0?(h=R>0?n.getCoordSize(b):C?p-n.getCoord(b):n.getCoord(b)-p,1===V&&Y[I]>h&&(h=Y[I]),C?x=g-=h:(d=g,g+=h)):0>b?(h=R>0?n.getCoordSize(b):C?n.getCoord(b)-c:c-n.getCoord(b),1===V&&Y[I]>h&&(h=Y[I]),C?(x=m,m+=h):d=m-=h):(h=0,C?x=g-=h:(d=g,g+=h)),o[I][k]=C?d+l/2:x-l/2,o[I].min>b&&(o[I].min=b,C?(o[I].minY=x,o[I].minX=o[I][k]):(o[I].minX=d+h,o[I].minY=o[I][k])),o[I].max<b&&(o[I].max=b,C?(o[I].maxY=x,o[I].maxX=o[I][k]):(o[I].maxX=d+h,o[I].maxY=o[I][k])),o[I].sum+=b,o[I].counter++,k%G==0&&(u=this._getBarItem(I,k,v.getNameByIndex(k),d,x-(C?0:l),C?l:h,C?h:l,C?"vertical":"horizontal"),this.shapeList.push(new r(u))));for(R=0,V=i[X].length;V>R;R++)y=(A=f[I=i[X][R]]).data[k],b=this.getDataFromOption(y,"-"),l=Math.min(S[I]||Number.MAX_VALUE,z[I]||T),"-"==b&&this.deepQuery([y,A,this.option],"calculable")&&(C?x=g-=L:(d=g,g+=L),(u=this._getBarItem(I,k,v.getNameByIndex(k),d,x-(C?0:l),C?l:L,C?L:l,C?"vertical":"horizontal")).hoverable=!1,u.draggable=!1,u.style.lineWidth=1,u.style.brushType="stroke",u.style.strokeColor=A.calculableHolderColor||this.ecTheme.calculableHolderColor||a.calculableHolderColor,this.shapeList.push(new r(u)));C?d+=l+N:x-=l+N}}this._calculMarkMapXY(o,i,C?"y":"x")},_buildHorizontal:function(e,t,i,r){return this._buildNormal(e,t,i,r,"horizontal")},_buildVertical:function(e,t,i,r){return this._buildNormal(e,t,i,r,"vertical")},_buildOther:function(e,t,i,a){for(var o=this.series,s=0,n=i.length;n>s;s++)for(var h=0,l=i[s].length;l>h;h++){var d=i[s][h],x=o[d],g=x.xAxisIndex||0,p=this.component.xAxis.getAxis(g),m=p.getCoord(0),c=x.yAxisIndex||0,u=this.component.yAxis.getAxis(c),y=u.getCoord(0);a[d]=a[d]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var b=0,f=x.data.length;f>b;b++){var I=x.data[b],A=this.getDataFromOption(I,"-");if(A instanceof Array){var C,M,B=p.getCoord(A[0]),v=u.getCoord(A[1]),_=[I,x],W=this.deepQuery(_,"barWidth")||10,N=this.deepQuery(_,"barHeight");null!=N?(C="horizontal",A[0]>0?B-=W=B-m:W=A[0]<0?m-B:0,M=this._getBarItem(d,b,A[0],B,v-N/2,W,N,C)):(C="vertical",A[1]>0?N=y-v:A[1]<0?v-=N=v-y:N=0,M=this._getBarItem(d,b,A[0],B-W/2,v,W,N,C)),this.shapeList.push(new r(M)),B=p.getCoord(A[0]),v=u.getCoord(A[1]),a[d].min0>A[0]&&(a[d].min0=A[0],a[d].minY0=v,a[d].minX0=B),a[d].max0<A[0]&&(a[d].max0=A[0],a[d].maxY0=v,a[d].maxX0=B),a[d].sum0+=A[0],a[d].counter0++,a[d].min1>A[1]&&(a[d].min1=A[1],a[d].minY1=v,a[d].minX1=B),a[d].max1<A[1]&&(a[d].max1=A[1],a[d].maxY1=v,a[d].maxX1=B),a[d].sum1+=A[1],a[d].counter1++}}}this._calculMarkMapXY(a,i,"xy")},_mapSize:function(e,t,i){var r,a,o=this._findSpecialBarSzie(t,i),s=o.barWidthMap,n=o.barMaxWidthMap,h=o.barMinHeightMap,l=o.sBarWidthCounter,d=o.sBarWidthTotal,x=o.barGap,g=o.barCategoryGap,p=1;if(t.length!=l){if(i)x=0,0>=(a=+((r=e.getGap())/t.length).toFixed(2))&&(p=Math.floor(t.length/r),a=1);else if(r="string"==typeof g&&g.match(/%$/)?(e.getGap()*(100-parseFloat(g))/100).toFixed(2)-0:e.getGap()-g,"string"==typeof x&&x.match(/%$/)?(x=parseFloat(x)/100,x*=a=+((r-d)/((t.length-1)*x+t.length-l)).toFixed(2)):a=+((r-d-(x=parseFloat(x))*(t.length-1))/(t.length-l)).toFixed(2),0>=a)return this._mapSize(e,t,!0)}else if(r=l>1?"string"==typeof g&&g.match(/%$/)?+(e.getGap()*(100-parseFloat(g))/100).toFixed(2):e.getGap()-g:d,a=0,0>(x=l>1?+((r-d)/(l-1)).toFixed(2):0))return this._mapSize(e,t,!0);return this._recheckBarMaxWidth(t,s,n,h,r,a,x,p)},_findSpecialBarSzie:function(e,t){for(var i,r,a,o,s=this.series,n={},h={},l={},d=0,x=0,g=0,p=e.length;p>g;g++)for(var m={barWidth:!1,barMaxWidth:!1},c=0,u=e[g].length;u>c;c++){var y=e[g][c],b=s[y];if(!t){if(m.barWidth)n[y]=i;else if(null!=(i=this.query(b,"barWidth"))){n[y]=i,x+=i,d++,m.barWidth=!0;for(var f=0,I=c;I>f;f++){n[e[g][f]]=i}}if(m.barMaxWidth)h[y]=r;else if(null!=(r=this.query(b,"barMaxWidth"))){h[y]=r,m.barMaxWidth=!0;for(f=0,I=c;I>f;f++){h[e[g][f]]=r}}}l[y]=this.query(b,"barMinHeight"),a=null!=a?a:this.query(b,"barGap"),o=null!=o?o:this.query(b,"barCategoryGap")}return{barWidthMap:n,barMaxWidthMap:h,barMinHeightMap:l,sBarWidth:i,sBarMaxWidth:r,sBarWidthCounter:d,sBarWidthTotal:x,barGap:a,barCategoryGap:o}},_recheckBarMaxWidth:function(e,t,i,r,a,o,s,n){for(var h=0,l=e.length;l>h;h++){var d=e[h][0];i[d]&&i[d]<o&&(a-=o-i[d])}return{barWidthMap:t,barMaxWidthMap:i,barMinHeightMap:r,gap:a,barWidth:o,barGap:s,interval:n}},_getBarItem:function(e,t,i,r,a,s,h,l){var d,x=this.series,g=x[e],p=g.data[t],m=this._sIndex2ColorMap[e],c=[p,g],u=this.deepMerge(c,"itemStyle.normal"),y=this.deepMerge(c,"itemStyle.emphasis"),b=u.barBorderWidth,f=(d={zlevel:g.zlevel,z:g.z,clickable:this.deepQuery(c,"clickable"),style:{x:r,y:a,width:s,height:h,brushType:"both",color:this.getItemStyleColor(this.deepQuery(c,"itemStyle.normal.color")||m,e,t,p),radius:u.barBorderRadius,lineWidth:b,strokeColor:u.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(c,"itemStyle.emphasis.color"),e,t,p),radius:y.barBorderRadius,lineWidth:y.barBorderWidth,strokeColor:y.barBorderColor},_orient:l}).style;d.highlightStyle.color=d.highlightStyle.color||("string"==typeof f.color?n.lift(f.color,-.3):f.color),f.x=Math.floor(f.x),f.y=Math.floor(f.y),f.height=Math.ceil(f.height),f.width=Math.ceil(f.width),b>0&&f.height>b&&f.width>b?(f.y+=b/2,f.height-=b,f.x+=b/2,f.width-=b):f.brushType="fill",d.highlightStyle.textColor=d.highlightStyle.color;for(var I=[f,(d=this.addLabel(d,g,p,i,l)).highlightStyle],A=0,C=I.length;C>A;A++){var M=I[A].textPosition;if("insideLeft"===M||"insideRight"===M||"insideTop"===M||"insideBottom"===M){switch(M){case"insideLeft":I[A].textX=f.x+5,I[A].textY=f.y+f.height/2,I[A].textAlign="left",I[A].textBaseline="middle";break;case"insideRight":I[A].textX=f.x+f.width-5,I[A].textY=f.y+f.height/2,I[A].textAlign="right",I[A].textBaseline="middle";break;case"insideTop":I[A].textX=f.x+f.width/2,I[A].textY=f.y+2.5,I[A].textAlign="center",I[A].textBaseline="top";break;case"insideBottom":I[A].textX=f.x+f.width/2,I[A].textY=f.y+f.height-2.5,I[A].textAlign="center",I[A].textBaseline="bottom"}I[A].textPosition="specific",I[A].textColor=I[A].textColor||"#fff"}}return this.deepQuery([p,g,this.option],"calculable")&&(this.setCalculable(d),d.draggable=!0),o.pack(d,x[e],e,x[e].data[t],t,i),d},getMarkCoord:function(e,t){var i,r=this.series[e],a=this.xMarkMap[e],o=this.component.xAxis.getAxis(r.xAxisIndex),s=this.component.yAxis.getAxis(r.yAxisIndex);if(!t.type||"max"!==t.type&&"min"!==t.type&&"average"!==t.type)if(a.isHorizontal){var n=a["string"==typeof t.xAxis&&o.getIndexByName?o.getIndexByName(t.xAxis):t.xAxis||0];i=[n=null!=n?n:"string"!=typeof t.xAxis&&o.getCoordByIndex?o.getCoordByIndex(t.xAxis||0):o.getCoord(t.xAxis||0),s.getCoord(t.yAxis||0)]}else{var h=a["string"==typeof t.yAxis&&s.getIndexByName?s.getIndexByName(t.yAxis):t.yAxis||0];h=null!=h?h:"string"!=typeof t.yAxis&&s.getCoordByIndex?s.getCoordByIndex(t.yAxis||0):s.getCoord(t.yAxis||0),i=[o.getCoord(t.xAxis||0),h]}else{var l=null!=t.valueIndex?t.valueIndex:null!=a.maxX0?"1":"";i=[a[t.type+"X"+l],a[t.type+"Y"+l],a[t.type+"Line"+l],a[t.type+l]]}return i},refresh:function(e){e&&(this.option=e,this.series=e.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(e,t){function i(){0===--c&&t&&t()}for(var r=this.series,a={},s=0,n=e.length;n>s;s++)a[e[s][0]]=e[s];var h,l,d,x,g,p,m,c=0;for(s=this.shapeList.length-1;s>=0;s--)if(a[p=o.get(this.shapeList[s],"seriesIndex")]&&!a[p][3]&&"rectangle"===this.shapeList[s].type){if(m=o.get(this.shapeList[s],"dataIndex"),g=r[p],a[p][2]&&m===g.data.length-1){this.zr.delShape(this.shapeList[s].id);continue}if(!a[p][2]&&0===m){this.zr.delShape(this.shapeList[s].id);continue}"horizontal"===this.shapeList[s]._orient?(x=this.component.yAxis.getAxis(g.yAxisIndex||0).getGap(),d=a[p][2]?-x:x,h=0):(l=this.component.xAxis.getAxis(g.xAxisIndex||0).getGap(),h=a[p][2]?l:-l,d=0),this.shapeList[s].position=[0,0],c++,this.zr.animate(this.shapeList[s].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[h,d]}).done(i).start()}c||t&&t()}},s.inherits(t,i),e("../chart").define("bar",t),t});