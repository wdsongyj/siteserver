var $api=new utils.Api("/v1/users"),$captchaGetUrl=utils.getApiUrl("/v1/captcha/REGISTER-CAPTCHA"),$captchaCheckApi=new utils.Api("/v1/captcha/REGISTER-CAPTCHA/actions/check");window.top!=self&&(window.top.location=self.location);var data={pageConfig:null,pageAlert:null,userName:null,password:null,captcha:null,captchaUrl:null,styles:[],groups:[],groupId:0,isAgreement:!1},methods={load:function(t,e,i){if(this.pageConfig=t,this.pageConfig.userRegistrationAttributes)for(var a=this.pageConfig.userRegistrationAttributes.split(","),s=0;s<e.length;s++){var n=e[s];-1!==a.indexOf(n.attributeName)&&(n.value=n.defaultValue,this.styles.push(n))}this.groups=i,this.reload()},reload:function(){this.captcha="",this.captchaUrl=$captchaGetUrl+"?r="+(new Date).getTime()},checkCaptcha:function(){var t=this;utils.loading(!0),$captchaCheckApi.post({captcha:t.captcha},function(e){if(utils.loading(!1),e)return t.reload(),void(t.pageAlert={type:"danger",html:e.message});t.register()})},register:function(){for(var t=this,e={userName:this.userName,password:this.password,groupId:this.groupId},i=0;i<this.styles.length;i++){var a=this.styles[i];e[a.attributeName]=a.value}utils.loading(!0),$api.post(e,function(e,i){if(utils.loading(!1),e)return t.reload(),void(t.pageAlert={type:"danger",html:e.message});i.isChecked?alert({title:"恭喜，账号注册成功",type:"success",confirmButtonText:"进入登录页"}).then(function(){location.href="login.html"}):alert({title:"账号注册成功，请等待管理员审核",type:"success",confirmButtonText:"进入登录页"}).then(function(){location.href="login.html"})})},btnRegisterClick:function(t){t.preventDefault(),this.pageAlert=null;var e=this;this.$validator.validate().then(function(t){if(e.pageConfig.isHomeAgreement&&!e.isAgreement)return e.pageAlert={type:"danger",html:"请勾选"+e.pageConfig.homeAgreementHtml};t&&e.checkCaptcha()})}};new Vue({el:"#main",data:data,directives:{focus:{inserted:function(t){t.focus()}}},methods:methods,created:function(){var t=this;utils.getConfig("register",function(e){t.load(e.config,e.styles,e.groups)})}});