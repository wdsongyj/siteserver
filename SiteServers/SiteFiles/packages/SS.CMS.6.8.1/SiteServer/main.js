window.top!=self&&(window.top.location=self.location);var $url="/pages/main",$urlCreate="/pages/main/actions/create",$urlDownload="/pages/main/actions/download",$packageIdSsCms="SS.CMS",$siteId=parseInt(utils.getQueryString("siteId")||"0"),data={pageLoad:!1,pageAlert:null,defaultPageUrl:null,isNightly:null,version:null,isSuperAdmin:null,packageList:null,packageIds:null,currentVersion:null,topMenus:null,siteMenus:null,activeParentMenu:null,activeChildMenu:null,pluginMenus:null,local:null,newVersion:null,updatePackages:0,pendingCount:0,lastExecuteTime:new Date,timeoutId:null,winHeight:0,winWidth:0,isDesktop:!0,isMobileMenu:!1},methods={getConfig:function(){var e=this;$api.get($url+"?siteId="+$siteId).then(function(t){var i=t.data;i.value?(e.defaultPageUrl=i.defaultPageUrl,e.isNightly=i.isNightly,e.version=i.version,e.isSuperAdmin=i.isSuperAdmin,e.packageList=i.packageList,e.packageIds=i.packageIds,e.currentVersion=i.currentVersion,e.topMenus=i.topMenus,e.siteMenus=i.siteMenus,e.pluginMenus=i.pluginMenus,e.local=i.local,e.activeParentMenu=e.siteMenus[0]):location.href=i.redirectUrl}).then(function(){e.pageLoad=!0,setTimeout(e.ready,100)})},ready:function(){var e=this;window.onresize=e.winResize,window.onresize(),e.create(),e.isSuperAdmin&&e.getUpdates(),setInterval(function(){((new Date).getTime()-e.lastExecuteTime.getTime())/1e3/60>2&&e.create()},6e4),$("#sidebar").slimScroll({height:"auto",position:"right",size:"5px",color:"#495057",wheelStep:5})},getUpdates:function(){var e=this;$apiCloud.get("updates",{params:{isNightly:e.isNightly,pluginVersion:e.version,packageIds:e.packageIds.join(",")}}).then(function(t){for(var i=t.data,n=0;n<i.value.length;n++){var a=i.value[n];if(a&&a.version)if(a.pluginId==$packageIdSsCms)e.downloadSsCms(a);else{var s=$.grep(e.packageList,function(e){return e.id==a.pluginId});if(1==s.length){var r=s[0];r.version?-1==compareversion(r.version,a.version)&&e.updatePackages++:e.updatePackages++}}}}).catch(function(t){e.pageAlert=utils.getPageAlert(t)}).then(function(){e.pageLoad=!0})},downloadSsCms:function(e){var t=this;if(-1==compareversion(t.currentVersion,e.version)){var i=e.version.split(".")[0],n=e.version.split(".")[1];$api.post($urlDownload,{packageId:$packageIdSsCms,version:e.version}).then(function(a){a.data.value&&(t.newVersion={updatesUrl:"http://www.siteserver.cn/updates/v"+i+"_"+n+"/index.html",version:e.version,published:e.published,releaseNotes:e.releaseNotes})})}},create:function(){var e=this;clearTimeout(e.timeoutId),$api.post($urlCreate).then(function(t){var i=t.data;e.pendingCount=i.value,0===e.pendingCount?e.timeoutId=setTimeout(e.create,1e4):e.timeoutId=setTimeout(e.create,100)}).catch(function(t){401===t.response.status&&(location.href="pageLogin.cshtml"),e.timeoutId=setTimeout(e.create,1e3)}).then(function(){e.lastExecuteTime=new Date})},winResize:function(){this.winHeight=$(window).height(),this.winWidth=$(window).width(),this.isDesktop=this.winWidth>992},getHref:function(e){return e.href&&"_layer"!=e.target?e.href:"javascript:;"},getTarget:function(e){return e.target?e.target:"right"},btnTopMenuClick:function(e){"_layer"==e.target&&utils.openLayer({title:e.text,url:e.href,full:!0})},btnLeftMenuClick:function(e){e.hasChildren?this.activeParentMenu=this.activeParentMenu===e?null:e:(this.activeChildMenu=e,this.isMobileMenu=!1,"_layer"==e.target&&utils.openLayer({title:e.text,url:e.href,full:!0}))},btnMobileMenuClick:function(){this.isMobileMenu=!this.isMobileMenu}};function redirect(e){$("#right").src=e}function openPageCreateStatus(){return utils.openLayer({title:"生成进度查看",url:"cms/createStatus.cshtml?siteId="+$siteId,full:!0}),!1}function reloadPage(){document.getElementById("frmMain").contentWindow.location.reload(!0)}new Vue({el:"#wrapper",data:data,methods:methods,created:function(){this.getConfig()},computed:{leftMenuWidth:function(){return this.isDesktop?"200px":this.isMobileMenu?"100%":"200px"}}});