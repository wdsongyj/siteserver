var sourceIdUser=-1,sourceIdPreview=-99,data={pageConfig:null,pageLoad:!1,pageAlert:null,pageType:"",sites:[],channels:[],site:{},channel:{},allGroupNames:[],allTagNames:[],styles:[],allCheckedLevels:[],returnUrl:utils.getQueryString("returnUrl"),contentId:0,isColor:!1,isHot:!1,isRecommend:!1,isTop:!1,groupNames:[],tagNames:[],linkUrl:"",addDate:new Date,checkedLevel:0},methods={loadSite:function(e){this.pageConfig=e.config,this.sites=e.sites,this.channels=e.channels,this.site=e.site,this.channel=e.channel,this.allGroupNames=e.allGroupNames,this.allTagNames=e.allTagNames,this.site&&this.channel?this.loadContent(e.styles,e.checkedLevels,e.checkedLevel,e.content):this.pageType="Unauthorized"},loadChannel:function(e){this.loadContent(e.styles,e.checkedLevels,e.checkedLevel,e.value)},loadContent:function(e,t,i,n){var s=this;this.styles=[];for(let t=0;t<e.length;t++){var a=e[t];n.id?a.value=n[_.camelCase(a.attributeName)]:a.value=a.defaultValue||"",this.styles.push(a)}this.allCheckedLevels=t,this.contentId=n.id,this.isTop=n.isTop,this.isRecommend=n.isRecommend,this.isHot=n.isHot,this.isColor=n.isColor,this.groupNames=[],n.groupNameCollection&&(this.groupNames=n.groupNameCollection.split(",")),this.tagNames=[],n.tags&&(this.tagNames=n.tags.split(",")),this.linkUrl=n.linkUrl,this.addDate=n.addDate,this.checkedLevel=i,setTimeout(function(){for(var e=0;e<s.styles.length;e++){var t=s.styles[e];if("TextEditor"===t.inputType){var i=UE.getEditor(t.attributeName,{allowDivTransToP:!1,maximumWords:99999999});i.styleIndex=e,i.ready(function(){i.addListener("contentChange",function(){s.styles[this.styleIndex].value=this.getContent()})}),$("#"+t.attributeName).show()}}},100)},getValue:function(e){for(var t=0;t<this.styles.length;t++){var i=this.styles[t];if(i.attributeName===e)return i.value}return""},setValue:function(e,t){for(var i=0;i<this.styles.length;i++){var n=this.styles[i];n.attributeName===e&&(n.value=t)}},onSiteSelect:function(e){if(e.id!==this.site.id){var t=this;this.pageLoad=!1,utils.getConfig({pageName:"contentAdd",siteId:e.id},function(e){t.pageLoad=!0,t.loadSite(e)})}},onChannelSelect:function(e){if(e.id!==this.channel.id){var t=this;this.pageLoad=!1,utils.getConfig({pageName:"contentAdd",siteId:this.site.id,channelId:e.id},function(e){t.pageLoad=!0,t.loadChannel(e)})}},addTag:function(e){this.allTagNames.push(e),this.tagNames.push(e)},submit:function(e){for(var t=this,i={id:this.contentId,isTop:this.isTop,isRecommend:this.isRecommend,isHot:this.isHot,isColor:this.isColor,linkUrl:this.linkUrl,addDate:this.addDate,groupNameCollection:this.groupNames.join(","),tags:this.tagNames.join(","),checkedLevel:this.checkedLevel,sourceId:e},n=0;n<this.styles.length;n++){var s=this.styles[n];i[s.attributeName]=s.value}parent.utils.loading(!0),e==sourceIdPreview?new utils.Api("/v1/contents/"+this.site.id+"/"+this.channel.id).post(i,function(e,i){if(parent.utils.loading(!1),e)t.pageAlert={type:"danger",html:e.message};else{var n=t.contentId?t.contentId:i.value.id;window.open(utils.getApiUrl("/preview/"+t.site.id+"/"+t.channel.id+"/"+n+"?isPreview=true&previewId="+i.value.id))}}):i.id?new utils.Api("/v1/contents/"+this.site.id+"/"+this.channel.id+"/"+i.id).put(i,function(e,i){parent.utils.loading(!1),e?t.pageAlert={type:"danger",html:e.message}:parent.alert({toast:!0,type:"success",title:"稿件修改成功",showConfirmButton:!1,timer:3e3}).then(function(){parent.location.hash=t.returnUrl})}):new utils.Api("/v1/contents/"+this.site.id+"/"+this.channel.id).post(i,function(e,i){parent.utils.loading(!1),e?t.pageAlert={type:"danger",html:e.message}:t.pageType="success"})},btnLayerClick:function(e){this.pageAlert=null;var t="pages/contentAddLayer"+e.name+".html?siteId="+this.site.id+"&channelId="+this.channel.id;e.contentId&&(t+="&contentId="+e.contentId),e.args&&_.forIn(e.args,function(e,i){t+="&"+i+"="+encodeURIComponent(e)}),parent.utils.openLayer({title:e.title,url:t,full:e.full,width:e.width?e.width:700,height:e.height?e.height:500})},btnImageClick:function(e){top.utils.openImagesLayer([e])},btnContinueAddClick:function(){location.reload()},btnSubmitClick:function(){var e=this;this.pageAlert=null,this.$validator.validate().then(function(t){t&&e.submit(sourceIdUser)})},btnPreviewClick:function(){var e=this;this.pageAlert=null,this.$validator.validate().then(function(t){t&&e.submit(sourceIdPreview)})}};Vue.component("multiselect",window.VueMultiselect.default),Vue.component("date-picker",window.DatePicker.default);var $vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var e=this,t=0,i=0,n=parseInt(utils.getQueryString("contentId")||0);0==n?(t=parseInt(Cookies.get("SS-USER-SITE-ID")||0),i=parseInt(Cookies.get("SS-USER-CHANNEL-ID")||0)):(t=parseInt(utils.getQueryString("siteId")||0),i=parseInt(utils.getQueryString("channelId")||0)),utils.getConfig({pageName:"contentAdd",siteId:t,channelId:i,contentId:n},function(t){t.value?e.loadSite(t):utils.redirectLogin()})}}),getValue=function(e){return $vue.getValue(e)},setValue=function(e,t){$vue.setValue(e,t)};