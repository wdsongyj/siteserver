var $api=new utils.Api("/home/contentsLayerImport"),$uploadUrl=utils.getApiUrl("/home/contentsLayerImport"),data={siteId:parseInt(utils.getQueryString("siteId")),channelId:parseInt(utils.getQueryString("channelId")),pageLoad:!1,pageAlert:null,checkedLevels:null,importType:"zip",file:null,files:[],checkedLevel:null,isOverride:!1},methods={loadConfig:function(){var e=this;e.pageLoad=!0,$api.get({siteId:e.siteId,channelId:e.channelId},function(t,i){!t&&i&&i.value&&(e.checkedLevels=i.checkedLevels,e.checkedLevel=i.value,e.loadUploader())})},loadUploader:function(){var e=this,t=Q.event,i=Q.Uploader,n=document.getElementById("drop-area"),l=new i({url:$uploadUrl+"/actions/upload?siteId="+e.siteId+"&channelId="+e.channelId+"&userToken="+utils.getToken(),target:document.getElementById("drop-area"),allows:".zip,.csv,.txt",on:{add:function(t){if(t.ext!="."+e.importType)return alert({title:"文件错误！",text:"允许上传的文件格式为：."+e.importType,type:"error",showConfirmButton:!1}),!1},complete:function(t){var i=t.json;if(!i||1!=i.ret)return alert({title:"文件上传失败！",type:"error",showConfirmButton:!1});i&&i.fileName&&e.files.push(i)}}});i.support.html5&&l.html5?(t.add(n,"dragleave",t.stop),t.add(n,"dragenter",t.stop),t.add(n,"dragover",t.stop),t.add(n,"drop",function(e){t.stop(e);var i=e.dataTransfer.files;l.addList(i)})):n.innerHTML="点击批量上传文件"},del:function(e){this.files.splice(this.files.indexOf(e),1)},getFileNames:function(){for(var e=[],t=0;t<this.files.length;t++)e.push(this.files[t].fileName);return e},btnSubmitClick:function(){var e=this;if(this.pageAlert=null,!this.getFileNames().join(","))return alert({title:"请选择需要导入的文件！",type:"warning",showConfirmButton:!1});parent.utils.loading(!0),$api.post({siteId:e.siteId,channelId:e.channelId,importType:e.importType,fileNames:e.getFileNames(),checkedLevel:e.checkedLevel,isOverride:e.isOverride},function(t,i){if(parent.utils.loading(!1),t)return e.pageAlert={type:"danger",html:i.message};parent.location.reload(!0)})}};new Vue({el:"#main",data:data,methods:methods,created:function(){this.loadConfig()}});