var $api=new apiUtils.Api(apiUrl+"/pages/cms/contents"),$createApi=new apiUtils.Api(apiUrl+"/pages/cms/contents/actions/create");Object.defineProperty(Object.prototype,"getProp",{value:function(e){var t;for(t in this)if(t.toLowerCase()==e.toLowerCase())return this[t]}});var data={siteId:parseInt(pageUtils.getQueryStringByName("siteId")),channelId:parseInt(pageUtils.getQueryStringByName("channelId")),pageLoad:!1,pageAlert:null,pageType:null,page:1,pageContents:null,count:null,pages:null,permissions:null,columns:null,pageOptions:null,isAllChecked:!1},methods={btnAddClick:function(e){e.stopPropagation(),location.href="pageContentAdd.aspx?siteId="+this.siteId+"&channelId="+this.channelId},btnCreateClick:function(e){e.stopPropagation();var t=this;t.pageAlert=null,0!==t.selectedContentIds.length&&(pageUtils.loading(!0),$createApi.post({siteId:t.siteId,channelId:t.channelId,contentIds:t.selectedContentIds.join(",")},function(e,n){!e&&n&&n.value&&(pageUtils.loading(!1),t.pageAlert={type:"success",html:"内容已添加至生成列队！<a href='createStatus.cshtml?siteId="+t.siteId+"'>生成进度查看</a>"})}))},btnLayerClick:function(e,t){t.stopPropagation(),this.pageAlert=null;var n="contentsLayer"+e.name+".cshtml?siteId="+this.siteId+"&channelId="+this.channelId;if(e.withContents){if(0===this.selectedContentIds.length)return;n+="&contentIds="+this.selectedContentIds.join(",")}else e.contentId&&(n+="&contentId="+e.contentId);n+="&returnUrl="+encodeURIComponent(location.href),pageUtils.openLayer({title:e.title,url:n,full:e.full,width:e.width?e.width:700,height:e.height?e.height:500})},btnContentViewClick:function(e,t){t.stopPropagation(),pageUtils.openLayer({title:"查看内容",url:"contentsLayerView.cshtml?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+e,full:!0})},btnContentStateClick:function(e,t){t.stopPropagation(),pageUtils.openLayer({title:"查看审核状态",url:"contentsLayerState.cshtml?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+e,full:!0})},toggleChecked:function(e){e.isSelected=!e.isSelected,e.isSelected||(this.isAllChecked=!1)},selectAll:function(){this.isAllChecked=!this.isAllChecked;for(var e=0;e<this.pageContents.length;e++)this.pageContents[e].isSelected=this.isAllChecked},loadFirstPage:function(){1!==this.page&&this.loadContents(1)},loadPrevPage:function(){this.page-1<=0||this.loadContents(this.page-1)},loadNextPage:function(){this.page+1>this.pages||this.loadContents(this.page+1)},loadLastPage:function(){this.page+1>this.pages||this.loadContents(this.pages)},onPageSelect:function(e){this.loadContents(e)},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},getPluginMenuUrl:function(e){return e.href+"&returnUrl="+encodeURIComponent(location.href)},btnPluginMenuClick:function(e,t){t.stopPropagation(),"_layer"===e.target&&pageUtils.openLayer({title:e.text,url:this.getPluginMenuUrl(e),full:!0})},loadContents:function(e){var t=this;t.pageLoad&&pageUtils.loading(!0),$api.get({siteId:t.siteId,channelId:t.channelId,page:e},function(n,s){if(!n&&s&&s.value){for(var i=[],a=0;a<s.value.length;a++){var l=_.assign({},s.value[a],{isSelected:!1});i.push(l)}t.pageContents=i,t.count=s.count,t.pages=s.pages,t.permissions=s.permissions,t.columns=s.columns,t.page=e,t.pageOptions=[];for(a=1;a<=t.pages;a++)t.pageOptions.push(a);t.pageLoad?(pageUtils.loading(!1),t.scrollToTop()):t.pageLoad=!0}})}};Vue.component("multiselect",window.VueMultiselect.default);var $vue=new Vue({el:"#main",data:data,methods:methods,computed:{selectedContentIds:function(){var e=[];if(this.pageContents)for(var t=0;t<this.pageContents.length;t++)this.pageContents[t].isSelected&&e.push(this.pageContents[t].id);return e}},created:function(){this.loadContents(1)}});