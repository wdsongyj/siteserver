var $api=new apiUtils.Api(apiUrl+"/pages/settings/userMenu"),$apiReset=new apiUtils.Api(apiUrl+"/pages/settings/userMenu/actions/reset"),data={pageLoad:!1,pageAlert:null,pageType:"list",items:null,groups:null,item:null},methods={getItems:function(t){for(var e=[],i=0;i<t.length;i++){(n=t[i]).isGroup=!1,n.groupIds=[],n.groupIdCollection&&(n.isGroup=!0,n.groupIds=n.groupIdCollection.split(",")),0===n.parentId&&(n.children=[],e.push(n))}for(i=0;i<t.length;i++){var n;if((n=t[i]).parentId>0){var s=_.find(e,function(t){return t.id===n.parentId});s&&s.children.push(n)}}return e},getList:function(){var t=this;$api.get(null,function(e,i){!e&&i&&i.value&&(t.items=t.getItems(i.value),t.groups=i.groups,t.pageLoad=!0)})},getUserGroups:function(t){if(t.isGroup){var e="";return _.forEach(this.groups,function(i){-1!==t.groupIds.indexOf(i.id+"")&&(e+=", "+i.groupName)}),e?e.substr(2):""}return"所有用户组"},delete:function(t){var e=this;pageUtils.loading(!0),$api.delete({id:t},function(t,i){pageUtils.loading(!1),!t&&i&&i.value&&(e.items=e.getItems(i.value))})},reset:function(){var t=this;pageUtils.loading(!0),$apiReset.post(null,function(e,i){pageUtils.loading(!1),!e&&i&&i.value&&(t.items=t.getItems(i.value))})},submit:function(t){var e=this;t.groupIdCollection=t.isGroup?t.groupIds.join(","):"",pageUtils.loading(!0),$api.post(t,function(i,n){pageUtils.loading(!1),i?e.pageAlert={type:"danger",html:i.message}:(e.pageAlert={type:"success",html:-1===t.id?"用户菜单添加成功！":"用户菜单修改成功！"},e.item=null,e.items=e.getItems(n.value),e.pageType="list")})},btnAddClick:function(t){var e=0,i=null;t>0&&(i=this.items.find(function(e){return e.id===t})),i?_.forEach(i.children,function(t){t.taxis>e&&(e=t.taxis)}):_.forEach(this.items,function(t){t.taxis>e&&(e=t.taxis)}),this.item={id:0,systemId:"",groupIdCollection:"",isDisabled:!1,parentId:t,taxis:e+1,text:"",href:"",iconClass:"",target:"",isGroup:!1,groupIds:[]},this.pageType="add"},btnResetClick:function(){var t=this;pageUtils.alertDelete({title:"重置用户菜单",text:"此操作将把用户菜单恢复为系统默认值，确定吗？",button:"确认重置",callback:function(){t.reset()}})},btnEditClick:function(t){this.pageType="add",this.item=t},btnDeleteClick:function(t){var e=this;pageUtils.alertDelete({title:"删除用户菜单",text:"此操作将删除用户菜单 "+t.text+"，确定吗？",callback:function(){e.delete(t.id)}})},btnSubmitClick:function(){var t=this;this.$validator.validate().then(function(e){e&&t.submit(t.item)})},btnCancelClick:function(){this.pageType="list"}};new Vue({el:"#main",data:data,methods:methods,created:function(){this.getList()}});