define("echarts/chart/pie",["require","./base","zrender/shape/Text","zrender/shape/Ring","zrender/shape/Circle","zrender/shape/Sector","zrender/shape/Polyline","../config","../util/ecData","zrender/tool/util","zrender/tool/math","zrender/tool/color","../chart"],function(e){function t(e,t,i,l,a){s.call(this,e,t,i,l,a);var r=this;r.shapeHandler.onmouseover=function(e){var t=e.target,s=o.get(t,"seriesIndex"),i=o.get(t,"dataIndex"),l=o.get(t,"special"),a=[t.style.x,t.style.y],n=t.style.startAngle,h=((t.style.endAngle+n)/2+360)%360,d=t.highlightStyle.color,c=r.getLabel(s,i,l,a,h,d,!0);c&&r.zr.addHoverShape(c);var y=r.getLabelLine(s,i,a,t.style.r0,t.style.r,h,d,!0);y&&r.zr.addHoverShape(y)},this.refresh(l)}var s=e("./base"),i=e("zrender/shape/Text"),l=e("zrender/shape/Ring"),a=e("zrender/shape/Circle"),r=e("zrender/shape/Sector"),n=e("zrender/shape/Polyline"),h=e("../config");h.pie={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockWise:!0,startAngle:90,minAngle:0,selectedOffset:10,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1,type:"solid"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!1},labelLine:{show:!1,length:20,lineStyle:{width:1,type:"solid"}}}}};var o=e("../util/ecData"),d=e("zrender/tool/util"),c=e("zrender/tool/math"),y=e("zrender/tool/color");return t.prototype={type:h.CHART_TYPE_PIE,_buildShape:function(){var e,t,s,i=this.series,r=this.component.legend;this.selectedMap={},this._selected={},this._selectedMode=!1;for(var n,d=0,c=i.length;c>d;d++)if(i[d].type===h.CHART_TYPE_PIE){if(i[d]=this.reformOption(i[d]),this.legendHoverLink=i[d].legendHoverLink||this.legendHoverLink,n=i[d].name||"",this.selectedMap[n]=!r||r.isSelected(n),!this.selectedMap[n])continue;e=this.parseCenter(this.zr,i[d].center),t=this.parseRadius(this.zr,i[d].radius),this._selectedMode=this._selectedMode||i[d].selectedMode,this._selected[d]=[],this.deepQuery([i[d],this.option],"calculable")&&(s={zlevel:i[d].zlevel,z:i[d].z,hoverable:!1,style:{x:e[0],y:e[1],r0:t[0]<=10?0:t[0]-10,r:t[1]+10,brushType:"stroke",lineWidth:1,strokeColor:i[d].calculableHolderColor||this.ecTheme.calculableHolderColor||h.calculableHolderColor}},o.pack(s,i[d],d,void 0,-1),this.setCalculable(s),s=t[0]<=10?new a(s):new l(s),this.shapeList.push(s)),this._buildSinglePie(d),this.buildMark(d)}this.addShapeList()},_buildSinglePie:function(e){for(var t,s=this.series[e],i=s.data,l=this.component.legend,a=0,r=0,n=0,h=Number.NEGATIVE_INFINITY,o=[],d=0,c=i.length;c>d;d++)t=i[d].name,this.selectedMap[t]=!l||l.isSelected(t),this.selectedMap[t]&&!isNaN(i[d].value)&&(0!=+i[d].value?a++:r++,n+=+i[d].value,h=Math.max(h,+i[d].value));if(0!==n){var y,p,u,_,g,b,f=100,m=s.clockWise,L=(s.startAngle.toFixed(2)-0+360)%360,v=s.minAngle||.01,x=360-v*a-.01*r,z=s.roseType;for(d=0,c=i.length;c>d;d++)if(t=i[d].name,this.selectedMap[t]&&!isNaN(i[d].value)){var S;if(p=l?l.getColor(t):this.zr.getColor(d),f=i[d].value/n,y=(y="area"!=z?m?L-f*x-(0!==f?v:.01):f*x+L+(0!==f?v:.01):m?L-360/c:360/c+L).toFixed(2)-0,f=(100*f).toFixed(2),u=this.parseCenter(this.zr,s.center),g=+(_=this.parseRadius(this.zr,s.radius))[0],b=+_[1],"radius"===z?b=i[d].value/h*(b-g)*.8+.2*(b-g)+g:"area"===z&&(b=Math.sqrt(i[d].value/h)*(b-g)+g),m)S=L,L=y,y=S;this._buildItem(o,e,d,f,i[d].selected,u,g,b,L,y,p),m||(L=y)}this._autoLabelLayout(o,u,b);for(d=0,c=o.length;c>d;d++)this.shapeList.push(o[d]);o=null}},_buildItem:function(e,t,s,i,l,a,r,n,h,d,c){var y=this.series,p=((d+h)/2+360)%360,u=this.getSector(t,s,i,l,a,r,n,h,d,c);o.pack(u,y[t],t,y[t].data[s],s,y[t].data[s].name,i),e.push(u);var _=this.getLabel(t,s,i,a,p,c,!1),g=this.getLabelLine(t,s,a,r,n,p,c,!1);g&&(o.pack(g,y[t],t,y[t].data[s],s,y[t].data[s].name,i),e.push(g)),_&&(o.pack(_,y[t],t,y[t].data[s],s,y[t].data[s].name,i),_._labelLine=g,e.push(_))},getSector:function(e,t,s,i,l,a,n,h,o,d){var p=this.series[e],u=p.data[t],_=[u,p],g=this.deepMerge(_,"itemStyle.normal")||{},b=this.deepMerge(_,"itemStyle.emphasis")||{},f=this.getItemStyleColor(g.color,e,t,u)||d,m=this.getItemStyleColor(b.color,e,t,u)||("string"==typeof f?y.lift(f,-.2):f),L={zlevel:p.zlevel,z:p.z,clickable:this.deepQuery(_,"clickable"),style:{x:l[0],y:l[1],r0:a,r:n,startAngle:h,endAngle:o,brushType:"both",color:f,lineWidth:g.borderWidth,strokeColor:g.borderColor,lineJoin:"round"},highlightStyle:{color:m,lineWidth:b.borderWidth,strokeColor:b.borderColor,lineJoin:"round"},_seriesIndex:e,_dataIndex:t};if(i){var v=((L.style.startAngle+L.style.endAngle)/2).toFixed(2)-0;L.style._hasSelected=!0,L.style._x=L.style.x,L.style._y=L.style.y;var x=this.query(p,"selectedOffset");L.style.x+=c.cos(v,!0)*x,L.style.y-=c.sin(v,!0)*x,this._selected[e][t]=!0}else this._selected[e][t]=!1;return this._selectedMode&&(L.onclick=this.shapeHandler.onclick),this.deepQuery([u,p,this.option],"calculable")&&(this.setCalculable(L),L.draggable=!0),(this._needLabel(p,u,!0)||this._needLabelLine(p,u,!0))&&(L.onmouseover=this.shapeHandler.onmouseover),new r(L)},getLabel:function(e,t,s,l,a,r,n){var h=this.series[e],o=h.data[t];if(this._needLabel(h,o,n)){var y,p,u,_=n?"emphasis":"normal",g=d.merge(d.clone(o.itemStyle)||{},h.itemStyle),b=g[_].label,f=b.textStyle||{},m=l[0],L=l[1],v=this.parseRadius(this.zr,h.radius);b.position=b.position||g.normal.label.position,"center"===b.position?(y=m,p=L,u="center"):"inner"===b.position||"inside"===b.position?(v=(v[0]+v[1])*(b.distance||.5),y=Math.round(m+v*c.cos(a,!0)),p=Math.round(L-v*c.sin(a,!0)),r="#fff",u="center"):(v=v[1]- -g[_].labelLine.length,y=Math.round(m+v*c.cos(a,!0)),p=Math.round(L-v*c.sin(a,!0)),u=a>=90&&270>=a?"right":"left"),"center"!=b.position&&"inner"!=b.position&&"inside"!=b.position&&(y+="left"===u?20:-20),o.__labelX=y-("left"===u?5:-5),o.__labelY=p;var x=new i({zlevel:h.zlevel,z:h.z+1,hoverable:!1,style:{x:y,y:p,color:f.color||r,text:this.getLabelText(e,t,s,_),textAlign:f.align||u,textBaseline:f.baseline||"middle",textFont:this.getFont(f)},highlightStyle:{brushType:"fill"}});return x._radius=v,x._labelPosition=b.position||"outer",x._rect=x.getRect(x.style),x._seriesIndex=e,x._dataIndex=t,x}},getLabelText:function(e,t,s,i){var l=this.series[e],a=l.data[t],r=this.deepQuery([a,l],"itemStyle."+i+".label.formatter");return r?"function"==typeof r?r.call(this.myChart,{seriesIndex:e,seriesName:l.name||"",series:l,dataIndex:t,data:a,name:a.name,value:a.value,percent:s}):"string"==typeof r?r=(r=r.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}")).replace("{a0}",l.name).replace("{b0}",a.name).replace("{c0}",a.value).replace("{d0}",s):void 0:a.name},getLabelLine:function(e,t,s,i,l,a,r,h){var o=this.series[e],y=o.data[t];if(this._needLabelLine(o,y,h)){var p=h?"emphasis":"normal",u=d.merge(d.clone(y.itemStyle)||{},o.itemStyle)[p].labelLine,_=u.lineStyle||{},g=s[0],b=s[1],f=l,m=this.parseRadius(this.zr,o.radius)[1]- -u.length,L=c.cos(a,!0),v=c.sin(a,!0);return new n({zlevel:o.zlevel,z:o.z+1,hoverable:!1,style:{pointList:[[g+f*L,b-f*v],[g+m*L,b-m*v],[y.__labelX,y.__labelY]],strokeColor:_.color||r,lineType:_.type,lineWidth:_.width},_seriesIndex:e,_dataIndex:t})}},_needLabel:function(e,t,s){return this.deepQuery([t,e],"itemStyle."+(s?"emphasis":"normal")+".label.show")},_needLabelLine:function(e,t,s){return this.deepQuery([t,e],"itemStyle."+(s?"emphasis":"normal")+".labelLine.show")},_autoLabelLayout:function(e,t,s){for(var i=[],l=[],a=0,r=e.length;r>a;a++)("outer"===e[a]._labelPosition||"outside"===e[a]._labelPosition)&&(e[a]._rect._y=e[a]._rect.y,e[a]._rect.x<t[0]?i.push(e[a]):l.push(e[a]));this._layoutCalculate(i,t,s,-1),this._layoutCalculate(l,t,s,1)},_layoutCalculate:function(e,t,s,i){function l(t,s,i){for(var l=t;s>l;l++)if(e[l]._rect.y+=i,e[l].style.y+=i,e[l]._labelLine&&(e[l]._labelLine.style.pointList[1][1]+=i,e[l]._labelLine.style.pointList[2][1]+=i),l>t&&s>l+1&&e[l+1]._rect.y>e[l]._rect.y+e[l]._rect.height)return void a(l,i/2);a(s-1,i/2)}function a(t,s){for(var i=t;i>=0&&(e[i]._rect.y-=s,e[i].style.y-=s,e[i]._labelLine&&(e[i]._labelLine.style.pointList[1][1]-=s,e[i]._labelLine.style.pointList[2][1]-=s),!(i>0&&e[i]._rect.y>e[i-1]._rect.y+e[i-1]._rect.height));i--);}function r(e,t,s,i,l){for(var a,r,n,h=s[0],o=s[1],d=t?Number.MAX_VALUE:0,c=0,y=e.length;y>c;c++)r=Math.abs(e[c]._rect.y-o),a=i+(n=e[c]._radius-i)>r?Math.sqrt((i+n+20)*(i+n+20)-Math.pow(e[c]._rect.y-o,2)):Math.abs(e[c]._rect.x+(l>0?0:e[c]._rect.width)-h),t&&a>=d&&(a=d-10),!t&&d>=a&&(a=d+10),e[c]._rect.x=e[c].style.x=h+a*l,e[c]._labelLine&&(e[c]._labelLine.style.pointList[2][0]=h+(a-5)*l,e[c]._labelLine.style.pointList[1][0]=h+(a-20)*l),d=a}e.sort(function(e,t){return e._rect.y-t._rect.y});for(var n,h=0,o=e.length,d=[],c=[],y=0;o>y;y++)0>(n=e[y]._rect.y-h)&&l(y,o,-n),h=e[y]._rect.y+e[y]._rect.height;this.zr.getHeight()-h<0&&a(o-1,h-this.zr.getHeight());for(y=0;o>y;y++)e[y]._rect.y>=t[1]?c.push(e[y]):d.push(e[y]);r(c,!0,t,s,i),r(d,!1,t,s,i)},reformOption:function(e){var t=d.merge;return(e=t(t(e||{},d.clone(this.ecTheme.pie||{})),d.clone(h.pie))).itemStyle.normal.label.textStyle=this.getTextStyle(e.itemStyle.normal.label.textStyle),e.itemStyle.emphasis.label.textStyle=this.getTextStyle(e.itemStyle.emphasis.label.textStyle),this.z=e.z,this.zlevel=e.zlevel,e},refresh:function(e){e&&(this.option=e,this.series=e.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(e,t){function s(){0===--n&&t&&t()}for(var i=this.series,l={},a=0,r=e.length;r>a;a++)l[e[a][0]]=e[a];var n=0,o={},d={},c={},y=this.shapeList;this.shapeList=[];var p,u,_,g={};for(a=0,r=e.length;r>a;a++)p=e[a][0],u=e[a][2],_=e[a][3],i[p]&&i[p].type===h.CHART_TYPE_PIE&&(u?(_||(o[p+"_"+i[p].data.length]="delete"),g[p]=1):_?g[p]=0:(o[p+"_-1"]="delete",g[p]=-1),this._buildSinglePie(p));var b,f;for(a=0,r=this.shapeList.length;r>a;a++)switch(p=this.shapeList[a]._seriesIndex,b=this.shapeList[a]._dataIndex,f=p+"_"+b,this.shapeList[a].type){case"sector":o[f]=this.shapeList[a];break;case"text":d[f]=this.shapeList[a];break;case"polyline":c[f]=this.shapeList[a]}this.shapeList=[];var m;for(a=0,r=y.length;r>a;a++)if(l[p=y[a]._seriesIndex]){if(!(m=o[f=p+"_"+(b=y[a]._dataIndex+g[p])]))continue;if("sector"===y[a].type)"delete"!=m?(n++,this.zr.animate(y[a].id,"style").when(400,{startAngle:m.style.startAngle,endAngle:m.style.endAngle}).done(s).start()):(n++,this.zr.animate(y[a].id,"style").when(400,g[p]<0?{startAngle:y[a].style.startAngle}:{endAngle:y[a].style.endAngle}).done(s).start());else if("text"===y[a].type||"polyline"===y[a].type)if("delete"===m)this.zr.delShape(y[a].id);else switch(y[a].type){case"text":n++,m=d[f],this.zr.animate(y[a].id,"style").when(400,{x:m.style.x,y:m.style.y}).done(s).start();break;case"polyline":n++,m=c[f],this.zr.animate(y[a].id,"style").when(400,{pointList:m.style.pointList}).done(s).start()}}this.shapeList=y,n||t&&t()},onclick:function(e){var t=this.series;if(this.isClick&&e.target){this.isClick=!1;for(var s,i=e.target,l=i.style,a=o.get(i,"seriesIndex"),r=o.get(i,"dataIndex"),n=0,d=this.shapeList.length;d>n;n++)if(this.shapeList[n].id===i.id){if(a=o.get(i,"seriesIndex"),r=o.get(i,"dataIndex"),l._hasSelected)i.style.x=i.style._x,i.style.y=i.style._y,i.style._hasSelected=!1,this._selected[a][r]=!1;else{var y=((l.startAngle+l.endAngle)/2).toFixed(2)-0;i.style._hasSelected=!0,this._selected[a][r]=!0,i.style._x=i.style.x,i.style._y=i.style.y,s=this.query(t[a],"selectedOffset"),i.style.x+=c.cos(y,!0)*s,i.style.y-=c.sin(y,!0)*s}this.zr.modShape(i.id)}else this.shapeList[n].style._hasSelected&&"single"===this._selectedMode&&(a=o.get(this.shapeList[n],"seriesIndex"),r=o.get(this.shapeList[n],"dataIndex"),this.shapeList[n].style.x=this.shapeList[n].style._x,this.shapeList[n].style.y=this.shapeList[n].style._y,this.shapeList[n].style._hasSelected=!1,this._selected[a][r]=!1,this.zr.modShape(this.shapeList[n].id));this.messageCenter.dispatch(h.EVENT.PIE_SELECTED,e.event,{selected:this._selected,target:o.get(i,"name")},this.myChart),this.zr.refreshNextFrame()}}},d.inherits(t,s),e("../chart").define("pie",t),t});